---
title: Webapckä»£ç åˆ†ç¦»
date: 2019-02-14 16:28:34
tags:
- webpack
categories:
- å‰ç«¯,æ¯å¤©å­¦ä¸€ç‚¹
---

ä»£ç åˆ†ç¦»æ˜¯ `webpack` ä¸­æœ€å¼•äººæ³¨ç›®çš„ç‰¹æ€§ä¹‹ä¸€ã€‚æ­¤ç‰¹æ€§èƒ½å¤ŸæŠŠä»£ç åˆ†ç¦»åˆ°ä¸åŒçš„ `bundle` ä¸­ï¼Œç„¶åå¯ä»¥æŒ‰éœ€åŠ è½½æˆ–å¹¶è¡ŒåŠ è½½è¿™äº›æ–‡ä»¶ã€‚ä»£ç åˆ†ç¦»å¯ä»¥ç”¨äºè·å–æ›´å°çš„ `bundle`ï¼Œä»¥åŠæ§åˆ¶èµ„æºåŠ è½½ä¼˜å…ˆçº§ï¼Œå¦‚æœä½¿ç”¨åˆç†ï¼Œä¼šæå¤§å½±å“åŠ è½½æ—¶é—´ğŸ˜ğŸ˜ğŸ˜ã€‚

<!-- more -->


## ä¸€. åº”ç”¨åœºæ™¯

> åˆ†ç¦»ä¸šåŠ¡ä»£ç  å’Œ ç¬¬ä¸‰æ–¹ä¾èµ–

> åˆ†ç¦»ä¸šåŠ¡ä»£ç  å’Œ ä¸šåŠ¡å…¬å…±ä»£ç  å’Œ ç¬¬ä¸‰æ–¹ä¾èµ–

> åˆ†ç¦»é¦–æ¬¡åŠ è½½ å’Œ è®¿é—®ååŠ è½½çš„ä»£ç  ï¼ˆç”¨äºé¦–å±åŠ è½½ï¼‰

## äºŒ. å¸¸ç”¨æ–¹æ³•

### 1. æå–å…¬å…±æ¨¡å—(é˜²æ­¢é‡å¤)

#### 1.1 é’ˆå¯¹å¤šé¡µé¢åº”ç”¨

æ‰“åŒ…çš„è¿‡ç¨‹ä¸­æœ‰å¤šä¸ªå…¥å£æ–‡ä»¶æ‰æœ‰æå–å…¬å…±ä»£ç çš„å¿…è¦ï¼Œå¦åˆ™ä¸å­˜åœ¨æå–å…¬å…±ä»£ç çš„éœ€æ±‚ï¼Œç›´æ¥æ‰“åŒ…åˆ°ä¸€ä¸ªæ–‡ä»¶é‡Œå°±å¯ä»¥äº†ã€‚

è¾“å‡ºçš„æ—¶å€™ç”Ÿæˆ`.bunle.js`æ–‡ä»¶å’Œ`.chunk.js`æ–‡ä»¶ã€‚

```javascript
entry:{
    pageA: './src/pageA.js',
    pageB: './src/pageB.js'
},
output: {
    path:path.resolve(__dirname,'build'),
    filename:'[name].bundle.js',
    chunkFilename:'[name].chunk.js'
}
```

#### 1.2 åˆ†ç¦»å…¬å…±ä»£ç 

webpack4å†…ç½®äº†æå–å…¬å…±ä»£ç çš„é…ç½®ï¼Œç”¨æ¥åˆ†ç¦»å…¬å…±ä»£ç å’Œå…±ç”¨çš„ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œ`chunks`ç”¨æ¥é€‰æ‹©éœ€è¦æŠ½å–å…¬å…±ä»£ç çš„å…¥å£æ–‡ä»¶(chunk)ï¼Œä¸€èˆ¬ä¼˜å…ˆåˆ†ç¦»å…¬å…±æ¨¡å—ï¼Œç„¶åå†æå–è‡ªå·±ä»£ç ä¸­çš„å…±ç”¨ä»£ç ï¼Œå› æ­¤`vendor`å…·æœ‰çš„ä¼˜å…ˆçº§`priority`æ›´é«˜ã€‚

```javascript
optimization: {
        splitChunks: {
            cacheGroups: {
                // è‡ªå·±çš„å…¬å…±ä»£ç 
                common: {
                    name: "common",
                    chunks: "all",
                    minSize: 1,
                    priority: 0
                },
                // ç¬¬ä¸‰æ–¹ä»£ç 
                vendor: {
                    name: "vendor",
                    test: /[\\/]node_modules[\\/]/,
                    chunks: "all",
                    priority: 10
                }
            }
        }
    }
```

### 2. åŠ¨æ€å¯¼å…¥

å½“æ¶‰åŠåˆ°åŠ¨æ€ä»£ç æ‹†åˆ†æ—¶ï¼Œ`webpack` æä¾›äº†ä¸¤ä¸ªç±»ä¼¼çš„æŠ€æœ¯ã€‚å¯¹äºåŠ¨æ€å¯¼å…¥ï¼Œç¬¬ä¸€ç§ï¼Œä¹Ÿæ˜¯æ¨èé€‰æ‹©çš„æ–¹å¼æ˜¯ï¼Œä½¿ç”¨ç¬¦åˆ `ECMAScript` ææ¡ˆçš„ `import()` è¯­æ³•ã€‚ç¬¬äºŒç§ï¼Œåˆ™æ˜¯ä½¿ç”¨ `webpack` ç‰¹å®šçš„ `require.ensure`ã€‚


ç°åœ¨ï¼Œä¸å†ä½¿ç”¨é™æ€å¯¼å…¥ `lodash`ï¼Œè€Œæ˜¯é€šè¿‡ä½¿ç”¨åŠ¨æ€å¯¼å…¥æ¥åˆ†ç¦»ä¸€ä¸ª `chunk`ï¼š

```javascript
function getComponent() {
    return import(/* webpackChunkName: "lodash" */ 'lodash').then(_ => {
        var element = document.createElement('div');
        var _ = _.default;
        element.innerHTML = _.join(['Hello', 'webpack'], ' ');
        return element;
    }).catch(error => 'An error occurred while loading the component');
}
getComponent().then(component => {
    document.body.appendChild(component);
})
```

æ³¨æ„ï¼šåœ¨æ³¨é‡Šä¸­ä½¿ç”¨äº† `webpackChunkName`ã€‚è¿™æ ·åšä¼šå¯¼è‡´æˆ‘ä»¬çš„ `bundle` è¢«å‘½åä¸º `lodash.bundle.js`ã€‚

** å¯¹äºæŒ‰éœ€åŠ è½½æˆ–åŠ è½½å¤–éƒ¨èµ„æºï¼ˆå¦‚å›¾ç‰‡ã€æ–‡ä»¶ç­‰ï¼‰æ¥è¯´ï¼Œ`output.publicPath` æ˜¯å¾ˆé‡è¦çš„é€‰é¡¹ã€‚å¦‚æœæŒ‡å®šäº†ä¸€ä¸ªé”™è¯¯çš„å€¼ï¼Œåˆ™åœ¨åŠ è½½è¿™äº›èµ„æºæ—¶ä¼šæ”¶åˆ° `404` é”™è¯¯ï¼Œå› æ­¤åœ¨ä½¿ç”¨`import()`æ—¶éœ€è¦ç‰¹åˆ«æ³¨æ„`output.publicPath`é…ç½®ã€‚

### 3.æ‡’åŠ è½½

æ‡’åŠ è½½æˆ–è€…æŒ‰éœ€åŠ è½½ï¼Œæ˜¯ä¸€ç§å¾ˆå¥½çš„ä¼˜åŒ–ç½‘é¡µæˆ–åº”ç”¨çš„æ–¹å¼ã€‚è¿™ç§æ–¹å¼å®é™…ä¸Šæ˜¯å…ˆæŠŠä½ çš„ä»£ç åœ¨ä¸€äº›é€»è¾‘æ–­ç‚¹å¤„åˆ†ç¦»å¼€ï¼Œç„¶ååœ¨ä¸€äº›ä»£ç å—ä¸­å®ŒæˆæŸäº›æ“ä½œåï¼Œç«‹å³å¼•ç”¨æˆ–å³å°†å¼•ç”¨å¦å¤–ä¸€äº›æ–°çš„ä»£ç å—ã€‚è¿™æ ·åŠ å¿«äº†åº”ç”¨çš„åˆå§‹åŠ è½½é€Ÿåº¦ï¼Œå‡è½»äº†å®ƒçš„æ€»ä½“ä½“ç§¯ï¼Œå› ä¸ºæŸäº›ä»£ç å—å¯èƒ½æ°¸è¿œä¸ä¼šè¢«åŠ è½½ã€‚

åœ¨åŠ¨æ€å¯¼å…¥ä¸­ï¼Œè™½ç„¶`lodash`è¢«åˆ†ç¦»å‡ºæ¥äº†ï¼Œä½†æ˜¯æ¯æ¬¡åŠ è½½é¡µé¢çš„æ—¶å€™éƒ½ä¼šè¯·æ±‚å®ƒã€‚è¿™æ ·åšå¹¶æ²¡æœ‰å¯¹æˆ‘ä»¬æœ‰å¾ˆå¤šå¸®åŠ©ï¼Œè¿˜ä¼šå¯¹æ€§èƒ½äº§ç”Ÿè´Ÿé¢å½±å“ã€‚

åœ¨å®é™…ç”Ÿäº§ä¸­ï¼Œæœ‰äº›æ¨¡å—å¹¶ä¸éœ€è¦é¡µé¢åŠ è½½å°±è¿›è¡Œè¯·æ±‚ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€‰æ‹©å°†è¿™äº›æ¨¡å—ååŠ è½½ï¼Œå½“å‘ç”Ÿç‰¹å®šäº‹ä»¶æ—¶å†å¯¹è¯¥æ¨¡å—è¿›è¡Œè¯·æ±‚ã€‚

```
button.onclick = e => import(/* webpackChunkName: "print" */ './print').then(module => {
    var print = module.default;
    print();
});
```

## ä¸‰. æ›´å¤š

webpack4ç³»åˆ—æ•™ç¨‹ï¼š[>>>ç‚¹æˆ‘è¿›å…¥](https://godbmw.com/categories/webpack4%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B/)

æœ¬æ–‡demoæºç åœ°å€ï¼š[>>>ç‚¹æˆ‘è¿›å…¥](https://github.com/Nirvana-cn/bundle-Vue/tree/master/demo)













